<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><title>You&#8217;ve been hacked! - Der Orkut-XSS-Wurm</title></head><body><h1>You&#8217;ve been hacked! - Der Orkut-XSS-Wurm</h1><p>Der <a href="http://antrix.net/posts/2007/orkut-xss/">Orkut-XSS-Wurm</a>breitete sich im Dezember 2007 in Orkut aus. In den "scraps" genanntenNachrichten an Freunde ist HTML erlaubt. Der Wurm sendete zuerst eineFlash-Datei als Scrap, bei deren Betrachten eine Datei mit getarnten(obfuscated) JavaScript-Code geladen wurde. Der Wurm-Code f&uuml;gte dasOpfer dann zur Gruppe &quot;Infectatos pelo Virus do Orkut&quot;(&quot;Infiziert vom Orkut-Virus&quot;) hinzu und begann, die Flash-Dateials Scrap an die Freunde des Opfers zu senden. Die Gruppe soll bis zu655.000 Mitglieder gehabt haben, entsprechend viele Opfer hat der Wurm alsogefunden.</p><p>Der Orkut-XSS-Wurm machte im Prinzip nichts anderes als auch Samy undYamanner: Eine XSS-Schwachstelle zum Eindringen ausnutzen, dann &uuml;berXMLHttpRequests im Hintergrund das Opfer zur Gruppe <em>"Infectatos peloVirus do Orkut"</em> hinzuf&uuml;gen und nach neuen Opfern suchen. DieXSS-Schwachstelle bestand diesmal nicht in einem fehlerhaften JavaScript-oder HTML-Filter, der eigentlich unerw&uuml;nschten Code passierenl&auml;sst, sondern im Zulassen von Flash. Flash nutzt mit ActionScripteinen "JavaScript-Dialekt", dessen F&auml;higkeiten sich zwar auf denBereich Multimedia konzentrieren, die aber auch ausreichen, um Schaden imBrowser anzurichten. Der Wurm-Autor, laut Quelltext Rodrigo Lacerda, nutzteFlash aber nur, um den eigentlichen, in JavaScript geschriebenen Schadcodenachzuladen. Neu war auch, das der Schadcode getarnt (obfuscated) war: DerCode wurde mit<a href="http://dean.edwards.name/packer/">Dean Edwards Javascript Packer</a>gepackt. Wie man daraus den eigentlichen Quelltext zur&uuml;ckerh&auml;lt,wird in diesem<a href="http://yaisb.blogspot.com/2006/10/defeating-dean-edwards-javascript.html">Blogeintrag</a>von Ryan Cartner beschrieben. </p><p><a href="orkut-code.html">Hier</a>finden Sie lokale Kopien der verschiedenen Quelltexte samt Quellenangaben.</p><h2>Der Code</h2><p>Der Code wurde automatisch ausgef&uuml;hrt, wenn die infizierteScrap-Nachricht mit dem Titel <em>"2008 vem ai... que ele comece mto bempara vc"</em> (auf deutsch etwa <em>"2008 kommt... ich hoffe es beginnt gutf&uuml;r dich"</em>) oder <em>"Boas Festas de final de Ano!"</em> (<em>"Habeine sch&ouml;ne Silvesterparty"</em>) gelesen wurde. Eine Aktion desOpfers &uuml;ber das &Ouml;ffnen der Nachricht hinaus war nicht notwendig.Zuerst wurde der Benutzer der genannten Gruppe hinzugef&uuml;gt. Dann wurdedie Freundesliste des Opfers gelesen und eine Scrap-Nachricht mit dem Wurmdarin an die Freunde geschickt. Dabei nutzte der Wurm einen Cookie, um denaktuellen Index in der Freundesliste zu speichern. War der 0, wurde derWurmcode zum ersten Mal im Browser des aktuellen Opfers gestartet und derBenutzer musste noch zur Gruppe hinzugef&uuml;gt werden. Anschlie&szlig;endbzw. wenn der Wert des Cookies gr&ouml;&szlig;er als 0 war, wurde derWurmcode an die Freunde des Opfers gesendet, an die er nicht zuvor bereitsgesendet worden war. Schlugen das Hinzuf&uuml;gen zur Gruppe oder dasSenden eines Scraps fehl, wurde die entsprechende Aktion erneut gestartet.</p><p>Die Verbreitung des Wurms endete entweder, weil Orkut ein Captcha vor dasVersenden von Scraps eingebaut hat, oder weil der Wurm-Autor den Schadcodeentfernt hat. In welcher Reihenfolge diese Aktionen stattfanden, ist nichtfestzustellen.</p><h2>Die Folgen</h2><p>Das Ganze war  kein Angriff im eigentlichen Sinn, sondern eineDemonstration einer gefundenen XSS-Schwachstelle und was damit auf einerSocial-Networking-Site angerichtet werden kann.</p><p>Die Reaktion von Orkut/Google zeigt, dass diese Vorgehensweise teilweise berechtigt war: Die Reaktion erfolgte viel zu langsam (siehe z.B. diesen <a href="https://web.archive.org/web/20071221144534/http://www.marrowbones.com/commons/technosocial/2007/12/orkut_worm_code_and_why_was_go.html">Blogeintrag</a>von Kee Hinckley), und die einzige Stellungnahme von Orkut dazu istausgesprochen mager, siehe diesen <a href="https://web.archive.org/web/20071222183555/http://en.blog.orkut.com/2007/12/security-reminder.html">Blogeintrag</a>im Orkut-Blog. Vor allem geht es darin nur um die versendeten Scraps.Dass die Wurm-Opfer auch zur Gruppe <em>"Infectatos pelo Virus do Orkut"</em> hinzugef&uuml;gt wurden, wird gar nicht erw&auml;hnt. </p><p>Zwei weitere pikante Details am Rande:</p><ul>    <li> Kurz vor Ausbruch des Wurm erschien im Orkut-Blog ein Beitrag mit dem Titel     <a href="https://web.archive.org/web/20071220210834/http://en.blog.orkut.com/2007/12/we-hear-you.html"><em>"We hear you!"</em></a>.    <li> Und w&auml;hrend der Wurm sich noch ausbreitete, wurde ein     Beitrag mit dem Titel     <a href="https://web.archive.org/web/20071222083824/http://en.blog.orkut.com/2007/12/planning-holiday-party.html"><em>"Planning a holiday party?"</em></a>    ver&ouml;ffentlicht: <br>    F&uuml;r Einladungen k&ouml;nnten die Benutzer Scraps benutzen, und     <cite>"If you're tech-savvy, you could even make it in HTML."</cite></ul><p>Der Wurm-Autor war sehr "tech-savvy", den er hat nicht nur einfaches HTML,sondern sogar JavaScript genutzt!</p><hr><p>Weiter<a href="orkut-code.html">zum Wurm-Code</a>oder zur&uuml;ck<a href="../kapitel5.html">zur Kapitel-Startseite</a>oder<a href="../../hacking-index.html">zur Doku-Startseite</a></p></body></html>